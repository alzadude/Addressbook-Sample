<?xml version="1.0"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
           xmlns:views="org.axonframework.examples.addressbook.views.*"
           xmlns:sf="http://www.spicefactory.org/parsley/flex"
           creationComplete="doSubscribe()"
        >
    <mx:Script><![CDATA[
        import mx.messaging.events.MessageEvent;

        import org.axonframework.examples.addressbook.messages.ChangeViewMessage;
        import org.axonframework.examples.addressbook.model.Address;

        public static const ALL_ADDRESSES:String = "allAddresses";
        public static const NEW_ADDRESS:String = "newAddress";

        [MessageHandler]
        public function showRightViewStack(changeViewMessage:ChangeViewMessage):void {
            trace('Switching the view ...');
            switch (changeViewMessage.stackId) {
                case ALL_ADDRESSES:
                    mainViewStack.selectedChild = addresses;
                    break;
                case NEW_ADDRESS:
                    mainViewStack.selectedChild = addAddress;
                    break;
                default:
                    mainViewStack.selectedChild = welcomeMessage
            }
        }

        public function messageHandler(event:MessageEvent):void {
            trace('message event : ' + event.type);
            var address:Address = event.message.body as Address;
            trace('Received an address event : ' + address.contactName);
        }

        public function acknowledgeHandler(event:Event):void {
            trace('acknowledge event : ');
            trace(event.toString());
        }

        public function faultHandler(event:Event):void {
            trace('*** fault event : ');
            trace(event.toString());
        }

        private function doSubscribe():void {
            consumer.subscribe();
        }

        ]]></mx:Script>

    <mx:Consumer id="consumer" destination="event-bus" channelSet="{cs}" message="messageHandler(event)"
                 acknowledge="acknowledgeHandler(event);" fault=" faultHandler(event)"/>

    <mx:ChannelSet id="cs">
        <mx:AMFChannel url="http://localhost:8080/messagebroker/pollingamf"/>
    </mx:ChannelSet>

    <sf:Configure/>

    <mx:VBox width="100%" height="100%" top="8" left="8" right="8" bottom="8">
        <views:ToolbarView id="toolbar" width="100%"/>
        <mx:ViewStack id="mainViewStack" width="100%" height="100%">
            <mx:HBox id="welcomeMessage">
                <mx:Text text="Welcome to this very nice application ..."/>
            </mx:HBox>

            <views:AddressesView id="addresses" width="100%" height="100%"/>
            <views:AddAddressView id="addAddress" width="100%" height="100%"/>
        </mx:ViewStack>
    </mx:VBox>

</mx:Canvas>
