<?xml version="1.0"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
           xmlns:sf="http://www.spicefactory.org/parsley/flex"
           xmlns:views="org.axonframework.examples.addressbook.views.*"
           enterState="''"
        >

    <mx:Script><![CDATA[

        import mx.containers.TitleWindow;
        import mx.core.IFlexDisplayObject;
        import mx.events.ListEvent;
        import mx.managers.PopUpManager;

        import org.axonframework.examples.addressbook.messages.SelectContactMessage;
        import org.axonframework.examples.addressbook.model.Contact;
        import org.axonframework.examples.addressbook.model.ContactModel;
        import org.spicefactory.parsley.core.context.Context;

        [Inject]
        [Bindable]
        public var contactModel:ContactModel;

        [MessageDispatcher]
        public var dispatcher:Function;

        [Inject]
        public var context:Context;

        public function addAddressPopupAction():void {
            createPopup(new AddAddressPopupView());
        }

        public function addContactPopupAction():void {
            createPopup(new AddContactPopup());
        }

        private function showContactDetails(event:ListEvent):void {
            dispatcher(new SelectContactMessage(event.currentTarget.selectedItem as Contact));
            currentState = 'detail';
        }

        private function createPopup(win:TitleWindow):void {
            context.viewManager.addViewRoot(win);
            PopUpManager.addPopUp(win, this, true);
            PopUpManager.centerPopUp(win as IFlexDisplayObject);
        }]]></mx:Script>

    <sf:Configure/>

    <mx:states>
        <mx:State name="detail">
            <mx:SetProperty target="{contactControls}" name="visible" value="true"/>
        </mx:State>
    </mx:states>

    <mx:HBox>
        <mx:VBox>
            <mx:Button id="addContact" icon="@Embed(source='/assets/images/address_book_add.png')" label="Add Contact"
                       click="addContactPopupAction()"/>
            <mx:DataGrid dataProvider="{contactModel.contacts}" itemClick="showContactDetails(event)">
                <mx:columns>
                    <mx:DataGridColumn dataField="name" headerText="Name"/>
                </mx:columns>
            </mx:DataGrid>
        </mx:VBox>
        <mx:VBox id="contactControls" visible="false">
            <mx:HBox>
                <mx:Button id="editContact" icon="@Embed(source='/assets/images/address_book_edit.png')"
                           label="Edit Contact"/>
                <mx:Button id="deleteContact" icon="@Embed(source='/assets/images/address_book_delete.png')"
                           label="Delete Contact"/>
            </mx:HBox>
            <mx:HBox>
                <mx:DataGrid dataProvider="{contactModel.selectedContact.addresses}">
                    <mx:columns>
                        <mx:DataGridColumn dataField="type"/>
                        <mx:DataGridColumn dataField="street"/>
                        <mx:DataGridColumn dataField="zipCode"/>
                        <mx:DataGridColumn dataField="city"/>
                    </mx:columns>
                </mx:DataGrid>
                <mx:VBox>
                    <mx:Button id="addAddressButton" icon="@Embed(source='/assets/images/icon_add.png')"
                               label="Add address" click="addAddressPopupAction()" width="125"/>
                    <mx:Button id="deleteAddressButton" icon="@Embed(source='/assets/images/icon_delete.png')"
                               label="Delete address" width="125"/>
                    <mx:Button id="editAddressButton" icon="@Embed(source='/assets/images/icon_edit.png')"
                               label="Edit address" width="125"/>
                </mx:VBox>
            </mx:HBox>
        </mx:VBox>
    </mx:HBox>

</mx:Canvas>
